<script>
  document.addEventListener("DOMContentLoaded", function () {
    document.getElementById("checkButton").addEventListener("click", checkWeather);

    async function checkWeather() {
      const suburb = document.getElementById("suburb").value;
      alert(`Checking foraging conditions in: ${suburb}`); // You can remove this later

      try {
        const response = await fetch(`https://mushroom-backend-frwl.onrender.com/check?suburb=${suburb}`);
        if (!response.ok) {
          throw new Error("Network response was not ok");
        }

        const data = await response.json();
        const weatherInfo = document.getElementById("weather-info");
        weatherInfo.innerHTML = `
          <p><strong>üå° Temperature:</strong> ${data.avg_temperature}¬∞C</p>
          <p><strong>üíß Humidity:</strong> ${data.avg_humidity}%</p>
          <p><strong>üåß Rain Probability:</strong> ${data.avg_precipitation_probability}%</p>
          <p><strong>üí® Wind Speed:</strong> ${data.avg_wind_speed} km/h</p>
          <p class="${data.good_day ? 'text-green-700 font-semibold' : 'text-red-600 font-semibold'}">
            ${data.good_day ? '‚úÖ Great day for foraging!' : '‚ùå Not a good day for foraging.'}
          </p>
        `;

        const mushroomSection = document.getElementById("mushroom-info");
        const mushroomList = document.getElementById("mushroom-list");
        mushroomList.innerHTML = '';
        mushroomSection.classList.remove("hidden");

        if (data.recommended_mushrooms.length === 0) {
          mushroomList.innerHTML = '<p class="col-span-full text-center text-gray-700">No mushrooms are recommended for foraging today.</p>';
          return;
        }

        data.recommended_mushrooms.forEach(mushroom => {
          let imageUrl = '';
          switch (mushroom.toLowerCase()) {
            case 'porcini':
              imageUrl = 'https://upload.wikimedia.org/wikipedia/commons/4/4b/Boletus_edulis_JPG9.jpg';
              break;
            case 'poplar_boletes':
              imageUrl = 'https://upload.wikimedia.org/wikipedia/commons/9/9e/Leccinum_duriusculum_254194.jpg';
              break;
            case 'pine_rings':
              imageUrl = 'https://upload.wikimedia.org/wikipedia/commons/8/89/Lactarius_deliciosus.jpg';
              break;
            case 'agaricus':
              imageUrl = 'https://upload.wikimedia.org/wikipedia/commons/6/63/2012-07-09_Agaricus_subfloccosus_235732_crop.jpg';
              break;
            case 'white_parasols':
              imageUrl = 'https://upload.wikimedia.org/wikipedia/commons/0/0b/Chlorophyllum_molybdites.jpg';
              break;
            case 'wood_blewits':
              imageUrl = 'https://upload.wikimedia.org/wikipedia/commons/6/68/Clitocybe_nuda_2008_G1.jpg';
              break;
            case 'morels':
              imageUrl = 'https://upload.wikimedia.org/wikipedia/commons/5/5a/Morchella_conica.jpg';
              break;
            case 'blushers':
              imageUrl = 'https://upload.wikimedia.org/wikipedia/commons/6/68/Amanita_rubescens_02.jpg';
              break;
            case 'slippery_jills':
              imageUrl = 'https://upload.wikimedia.org/wikipedia/commons/f/f1/Suillus_salmonicolor.jpg';
              break;
            case 'weeping_bolete':
              imageUrl = 'https://upload.wikimedia.org/wikipedia/commons/4/49/Suillus_granulatus1.jpg';
              break;
            case 'bovine_bolete':
              imageUrl = 'https://upload.wikimedia.org/wikipedia/commons/5/5a/Suillus_bovinus1.jpg';
              break;
            case 'chicken_of_the_woods':
              imageUrl = 'https://upload.wikimedia.org/wikipedia/commons/1/1a/Laetiporus_sulphureus_JPG1.jpg';
              break;
            case 'termitomyces':
              imageUrl = 'https://upload.wikimedia.org/wikipedia/commons/f/f9/Termitomyces_clypeatus_1.jpg';
              break;
          }

          const mushroomCard = document.createElement("div");
          mushroomCard.className = "bg-white bg-opacity-90 rounded-lg shadow-md p-4 text-center hover:shadow-xl transition";

          const img = document.createElement("img");
          img.src = imageUrl;
          img.alt = mushroom;
          img.className = "w-full h-40 object-cover rounded-md mb-2";

          const name = document.createElement("h3");
          name.textContent = mushroom.charAt(0).toUpperCase() + mushroom.slice(1).replace(/_/g, " ");
          name.className = "text-lg font-semibold";

          mushroomCard.appendChild(img);
          mushroomCard.appendChild(name);
          mushroomList.appendChild(mushroomCard);
        });

      } catch (error) {
        alert("‚ùå Failed to fetch data: " + error.message);
      }
    }
  });
</script>
